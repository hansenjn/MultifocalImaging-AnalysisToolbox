# MATLAB scripts for MultifocalImaging-AnalysisToolbox
This folder contains matlab scripts for further analysis and visualization of the data produced by the different plugins from the MultifocalImaging-AnalysisToolbox. 

This script belongs to the software published along https://doi.org/10.1101/2020.05.16.099390 (see https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox).

Copyright (C) 2016-2021: Luis Alvarez

Contact: luis.alvarez(at)caesar.de

## 1. Estimating x, y, and z precision from statistics of bead displacement
The following programs calculate the tracks of beads based on a text file generated by the ImageJ plugin [MultiFocalParticleTracker-Complex-3](https://github.com/hansenjn/MultiFocalParticleTracker-Complex-3). An example data set can be downloaded [here](https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox/tree/master/Matlab%20scripts/Example%203D-PIV%20Brownian). Execute “TracksBuilder.m” to calculate the tracks of individual beads from the text files. The program will generate a Tracks.mat file containing the positions of beads in time and will generate an overview plot of the bead tracks:
<p align="center">
   <img src="https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox/blob/master/Matlab%20scripts/Images%20for%20Readme/Brownian_GlobalView.png" width=680>
   <br>
</p>

After this, run the software “StatisticsBeads.mlx”. This program computes the precision of the multifocal method from the mean squared displacement of the beads and their theoretical diffusion coefficient.
<p align="center">
   <img src="https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox/blob/master/Matlab%20scripts/Images%20for%20Readme/Brownian_StatisticsDisplacementBeads.png" width=300>
   <br>
</p>

## 2. Generating bead tracks and estimating the 3D flow
The following programs calculate the tracks of beads based on the text files generated by the software https://github.com/hansenjn/MultiFocalParticleTracker-Complex-3. An example data set can be downloaded [here](https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox/tree/master/Matlab%20scripts/Example%203D-PIV%20Around%20Sperm). Based on these tracks, the flow speed is computed. 

The program “Reconstruct_tracs.m” can be used to plot the overview of all tracks and to display individual tracks. It additionally draws in the background a reference frame with the extracted sperm shape. Tracks are generated based on a number of filters:

**MaxVelocity**: Filter for the particle velocity in µm per s and for connectivity of track positions between frames

**MinTrackDuration**: Number of time points required to keep the track

**MinTrackExtension**:  Start to end extension of the track. This is to avoid non-moving particles

**InterpolateGaps**: Boolean used for interpolation

**MaximalGapLength**: Maximal allowed time gaps (time points where the particle was not detected within range) allowed to connect points to generate tracks.

**PrecissionLimit**: Precission to filter out particle coordinates

<p align="center">
   <img src="https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox/blob/master/Matlab%20scripts/Images%20for%20Readme/PIV-Sperm_SideViewTracks.png" width=680>
   <br>
</p>

As an output of the program, a file (ParticleList.mat) is generated. Run the program “Flow.m” to calculate the flow profile from the particle list.

<p align="center">
   <img src="https://github.com/hansenjn/MultifocalImaging-AnalysisToolbox/blob/master/Matlab%20scripts/Images%20for%20Readme/PIV-Sperm_Rotated_2DFlow_AveragedZ.png" width=800>
   <br>
</p>

### Dependencies
The programs make use of the function mArrow3 from MATLAB central: Georg Stillfried (2021). mArrow3.m - easy-to-use 3D arrow (https://www.mathworks.com/matlabcentral/fileexchange/25372-marrow3-m-easy-to-use-3d-arrow), MATLAB Central File Exchange. Retrieved May 11, 2021.

